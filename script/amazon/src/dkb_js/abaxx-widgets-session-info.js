Abaxx.define("widgets.sessionInfo",function(){function initAll(){jQuery("div[data-abx-widget\x3dsession-info]").each(function(index,widget){var $widget=jQuery(widget);var options=$widget.data("abxOptions");if(!$widget.data("abxSessionInfoInitialized")){init(options.prefix,options.timeout,options.text,options.target,options.excludes,options.currentPart);$widget.data("abxSessionInfoInitialized",true)}})}var id;var sessionEndTime;var timeoutMillis;var resetSessionTimeout=function(){sessionEndTime=new Date((new Date).getTime()+
timeoutMillis)};var toString=function(){return"SessionInfo("+id+", endTime: "+sessionEndTime+")"};var init=function(idPrefix,sessionTimeoutInSeconds,sessionTimeoutText,sessionTimeoutTarget,excludes,currentPart){function ignore(excludes,part){var isExcluded=false;if(typeof part!=="undefined"&&part!="")$.each(excludes,function(i,exclude){var pattern="^"+exclude+"$";if(part.match(new RegExp(pattern,"g"))!=null){isExcluded=true;return false}});return isExcluded}var maxWidth;var intervalId;var barContainer=
"#"+idPrefix+"BarContainer";var sessionCountDown="#"+idPrefix+"Countdown";var progressBar="#"+idPrefix+"ProgressBar";var timeoutText=sessionTimeoutText;var timeoutTarget=sessionTimeoutTarget;var showProgress=jQuery(barContainer)!=null?jQuery(barContainer).length>0:false;var timeoutExcludes=excludes;var part=currentPart;id=idPrefix;if(showProgress)maxWidth=jQuery(barContainer).width();timeoutMillis=sessionTimeoutInSeconds*1E3;sessionEndTime=new Date((new Date).getTime()+timeoutMillis);var adjustProgressBar=
function(remainingMillis){var percentage=(timeoutMillis-remainingMillis)/timeoutMillis;var width=percentage*maxWidth;jQuery(progressBar).css("width",maxWidth-width+"px")};var doProgress=function(){var millisLeft=Math.floor(sessionEndTime.getTime()-(new Date).getTime());if(millisLeft>0){if(showProgress){adjustProgressBar(millisLeft);jQuery(sessionCountDown).text(Abaxx.util.formatTime(millisLeft))}}else{if(showProgress){jQuery(barContainer).hide();jQuery(sessionCountDown).text(timeoutText)}if(!ignore(timeoutExcludes,
part)){window.setTimeout("window.location.replace('"+timeoutTarget+"');",1E4);window.clearInterval(intervalId)}}};intervalId=window.setInterval(doProgress,500);jQuery(document).ajaxStop(resetSessionTimeout);return{resetSessionTimeout:resetSessionTimeout,toString:toString}};Abaxx.core.onReady(initAll);return{init:init,resetSessionTimeout:resetSessionTimeout,toString:toString}});