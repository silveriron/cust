!function(t){t.fn.syncSelectOptions=function(e){function l(t){this.localSelect=t}var a={selectID:null,data:null};return l.prototype.debugMode=!1,l.prototype.localSelectID=null,l.prototype.remoteSelectID=null,l.prototype.localStartVariation=null,l.prototype.localStartSelected=null,l.prototype.localSyncVariations=null,l.prototype.remoteSyncCalls=null,l.prototype.localSelect=null,l.prototype.remoteSelect=null,l.prototype.logDebug=function(e){if(this.debugMode){"undefined"!=typeof console&&console.log("["+this.localSelectID+"] "+e);var l=t("#debugDiv");l&&l.append("["+this.localSelectID+"] "+e+"<br>")}},l.prototype.importSettings=function(e,l){var a=t.extend(e,l);if("undefined"==typeof a.remoteSelectID?this.logDebug("INFO: Parameter remoteSelectID not available in plugin call"):this.remoteSelectID=a.remoteSelectID,"undefined"==typeof a.localStartVariation?this.logDebug("INFO: Parameter localStartVariation missing in plugin call"):this.localStartVariation="undefined"!=typeof this.localSelect.tryLocalStartVariation?this.localSelect.tryLocalStartVariation:a.localStartVariation,"undefined"==typeof a.localStartSelected?this.logDebug("INFO: Parameter localStartSelected missing in plugin call"):this.localStartSelected=a.localStartSelected,"undefined"==typeof a.localSyncVariations?this.logDebug("INFO: Parameter localSyncVariations missing in plugin call"):this.localSyncVariations=a.localSyncVariations,"undefined"==typeof a.remoteSyncCalls?this.logDebug("INFO: Parameter remoteSyncCalls missing in plugin call"):this.remoteSyncCalls=a.remoteSyncCalls,null!==this.remoteSyncCalls&&null===this.remoteSelectID)throw"remoteSyncCalls provided but no remoteSelectID";if(null!==this.remoteSelectID&&null===this.remoteSyncCalls)throw"remoteSElectID provided but no remoteSyncCalls";if(null!==this.localStartVariation&&null===this.localSyncVariations)throw"localStartVariation provided but no localSyncVariations available";if(null!==this.localSyncVariations&&null===this.localStartVariation)throw"localSyncVariations provided, but localStartVariation not available";if(null!==this.localStartSelected&&(null===this.localSyncVariations||null===this.localStartVariation))throw"localStartSelected provided but neither localSyncVariations nor localStartVariation available"},l.prototype.init=function(){var e=!0,l=t(this.localSelect);if(l){if(this.localSelectID=l.attr("id"),null!==this.remoteSelectID){var a="#"+this.remoteSelectID,o=t(a);o.length>0?this.remoteSelect=o[0]:e=!1}}else e=!1;return e},l.prototype.applyLocalStartVariation=function(){if(null!==this.localSyncVariations&&null!==this.localStartVariation){var e=t(this.localSelect),l=t("option",e);l.length>=0&&this.logDebug("INFO: Rendered HTML Options removed and and initial localSyncVariation rendered"),l.remove();for(var a=this.localSyncVariations[this.localStartVariation],o=a.length,n=0;o>n;n++){var i=a[n],r=i[0],c=i[1],e=t(this.localSelect),s=t("<option></option>").val(r).html(c);e.append(s)}null!==this.localStartSelected&&e.val(this.localStartSelected)}else this.logDebug("INFO: Rendered HTML Options used, no localSyncVariation or localStartVariation available"),this.handleMemorizedLocalSelection()},l.prototype.handleMemorizedLocalSelection=function(){if(this.remoteSelect){var e=t(this.localSelect),l=e.val(),a=this.getVariationKeyForRemote(l);null!==a&&(this.remoteSelect.tryLocalStartVariation=a),this.logDebug("INFO: localStartVariation overwritten for remoteSelect to "+a)}},l.prototype.attachSyncManagers=function(){this.localSelect.localSyncManager=this,null!==this.remoteSelect&&(this.remoteSelect.remoteSyncManager=this)},l.prototype.attachLocalChangeEvent=function(){t(this.localSelect).bind("change.syncSelectOptions",this.localChangeEventHandler)},l.prototype.detachLocalChangeEvent=function(){t(this.localSelect).unbind("change.syncSelectOptions")},l.prototype.localChangeEventHandler=function(){var t=this.localSyncManager.getVariationKeyForRemote();null!==t&&this.localSyncManager.remoteSelect.localSyncManager.updateLocalOptions(t)},l.prototype.triggerInitEventChange=function(){},l.prototype.getVariationKeyForRemote=function(e){var l=null;if(null!==this.remoteSyncCalls){var a=null;if("undefined"==typeof e)var a=t(this.localSelect).val();else a=e;if(l=this.remoteSyncCalls[a],!l)throw"Selected variationKey via optionElement for remoteCall not listed"}return l},l.prototype.updateLocalOptions=function(e){function l(t){var e=null;if(t-1>0)for(S=t-1;S--;S>=0){var l=i[S];if("rendered"==l.status){prevRenderedOptionVal=l.optionVal,e=n[prevRenderedOptionVal];break}}return e}this.detachLocalChangeEvent();var a=t(this.localSelect),o=t("option",a),n={};o.each(function(){var e=t(this);n[e.val()]=e});for(var i=[],r={},c=this.localSyncVariations[e],s=c.length,S=0;s>S;S++){var h=c[S],p=h[0],u=h[1];r[p]=u;var d=!0,y=n[p]?!0:!1,g="rendered";d&&!y&&(g="new");var f={status:g,optionVal:p,optionContent:u,position:S};i[S]=f}for(renderedOptionVal in n){var v=n[renderedOptionVal],m=v.html(),y=!0,d=r[renderedOptionVal]?!0:!1;!d&&y&&(this.logDebug("---> remove "+m),v.remove(),delete n[renderedOptionVal])}var V=1;for(p in r){var u=r[p],y=n[p]?!0:!1,d=!0;if(d&&!y){var b=t("<option></option>").val(p).html(u),D=l(V);if(null!==D)t(D).after(b),this.logDebug("---> should be attached: "+u+" (after previously rendered option)");else{var a=t(this.localSelect);a.prepend(b),this.logDebug("---> should be attached: "+u+" (at the very beginning)")}n[p]=b,i[V-1].status="rendered"}V++}this.attachLocalChangeEvent()},this.each(function(){var t=new l(this);t.importSettings(a,e);var o=t.init();if(t.applyLocalStartVariation(),!o)throw"Init of syncManager not successful";return t.attachSyncManagers(),t.attachLocalChangeEvent(),t.triggerInitEventChange(),!1})}}(jQuery),$.ccfregistry.pluginReady("syncSelectOptions");