!function(i,t){i.widget("ccf.coreDialog",i.ui.dialog,{currentTimerId:void 0,options:{delay:void 0,width:"auto",height:"auto",scope:"itx",snippetUrl:void 0,minializable:!1,reloadable:!1,openAsPopup:!1,lazySnippetLoading:!1,snippetQuery:".body",snippetUseOnlyInnerElements:!1,popupUrl:void 0,popup:void 0,appendCloseIcon:!1,dynUrlPlaceholder:[],dynUrlTemplate:void 0,dynPopupUrlTemplate:void 0,closeIconId:void 0,lazyTabSelector:void 0},_create:function(){this._width=this.options.width,this._height=this.options.height,this.options.width="auto",this.options.height="auto",t._create.call(this),this.updateDelay(this.options.delay),this.options.scope&&i(this.uiDialog).wrap('<div class="'+this.options.scope+'-scope"></div>');var o=this.element,e=this;e._addActions(),e._loadStyleguide(),void 0===e.options.snippetUrl||e.options.lazySnippetLoading||e.reload(e.options.snippetUrl),i(document).bind("cdbAjaxComplete",function(){i("span.appendAsCloseIcon",o).appendTo(i(o).closest("div[aria-describedby]").find(".ui-dialog-title")),e.isOpen()&&e._position()}),i(window).on("orientationchange resize",function(){e.isOpen()&&e._position()}),e._wrapIcons()},_setOption:function(i,o){switch(i){case"delay":this.updateDelay(o)}t._setOption.apply(this,arguments)},_wrapIcons:function(){0==this._findIconContainer().length&&i("button, a",this._getTitlebar()).wrap('<div class="floatRight"></div>')},_findIconContainer:function(){return this._getTitlebar().find(".floatRight")},_addActions:function(){var t=this;if((this.options.reloadable||this.options.openAsPopup||this.options.appendCloseIcon)&&t._wrapIcons(),this.options.reloadable&&(this.options.snippetUrl||this.options.dynUrlTemplate)){var o=i('<a title="Aktualisieren" class="uiIcon icon-refresh"></a>');o.on("click",function(){t.reload(t.options.snippetUrl)}),o.appendTo(this._findIconContainer())}if(this.options.openAsPopup&&(this.options.popupUrl||this.options.dynPopupUrlTemplate)){var o=i('<a title="Im Popup öffnen" class="uiIcon icon-top-right"></a>');o.on("click",function(){t.openAsPopup(),t.close()}),o.appendTo(this._findIconContainer())}if(this.options.appendCloseIcon){var e=i('<a class="layerCloseIcon" aria-label="Dialog schließen" title="Dialog schließen"></a>');this.options.closeIconId&&e.attr("id",this.options.closeIconId),e.on("click",function(){t.close()}),e.appendTo(this._findIconContainer())}if(this.options.minializable){var o=i('<a class="uiIcon icon-arrow-down toggleIcon" title="Minimieren"></a>');o.on("click",function(){t.minimize()}),o.prependTo(this._getTitlebar())}},_loadStyleguide:function(){i(this.element).loadStyleguideByScope({scope:this.options.scope})},_getTitlebar:function(){return i(this.element).closest("div[aria-describedby]").find(".ui-dialog-titlebar")},_getBody:function(){return i(this.element).closest(".ui-dialog").find(".ui-dialog-content")},reload:function(t){var o=this;o._setOption("position",{my:"top",at:"top+15%",of:window}),void 0!==t&&(o.options.snippetUrl=t),i(o.element).snippet({url:o.options.snippetUrl,filter:o.options.snippetQuery,useOnlyInnerElements:o.options.snippetUseOnlyInnerElements,success:function(t){var e=i(t).filter("h3");e.length>0&&o._setOption("title",i(e).text()),o.isOpen()&&o._position(),o.options.lazyTabSelector&&i(o.element).find(o.options.lazyTabSelector).on("tabsload",function(){})}})},_reloadHandler:function(i,t){this.reload(t)},minimize:function(){var i=this._getBody(),t=this._getTitlebar(),o=t.find(".toggleIcon");o.removeClass("icon-arrow-down"),o.removeClass("icon-arrow-right"),i.is(":visible")?(t.css("width",i.width()),o.addClass("icon-arrow-right")):(t.css("width",""),o.addClass("icon-arrow-down")),i.toggle()},openAsPopup:function(){var t=this,o="";"undefined"!=typeof t.options.popup&&"[object Object]"===Object.prototype.toString.call(t.options.popup)&&i.each(t.options.popup,function(i,t){o+=(0===o.length?"":",")+i+"="+t}),window.open(t.options.popupUrl,t.options.popup.name,o)},open:function(o){if(this.options.lazySnippetLoading&&this._getBody().empty(),i("a.appendAsCloseIcon",this.element).appendTo(this._findIconContainer()),void 0!==this.options.dynUrlPlaceholder&&void 0!==this.options.dynUrlTemplate){var e=this.options.dynUrlTemplate,n=this.options.dynPopupUrlTemplate,s=this.options.openAsPopup&&void 0!==this.options.dynPopupUrlTemplate;i.each(this.options.dynUrlPlaceholder,function(){var t=i("#"+this.id).val();t&&(void 0==this.maxLength||t.length<=this.maxLength)?(e=e.replace(this.placeholder,t),s&&(n=n.replace(this.placeholder,t))):(e=e.replace(this.placeholder,""),s&&(n=n.replace(this.placeholder,"")))}),this._setOption("snippetUrl",e),s&&this._setOption("popupUrl",n)}o&&void 0!==o.snippetUrl&&this._setOption("snippetUrl",o.snippetUrl),o&&void 0!==o.popupUrl&&this._setOption("popupUrl",o.popupUrl),this.options.lazySnippetLoading&&this.reload(this.options.snippetUrl);var p=t.open.apply(this,arguments);return i(this.element).trigger("dialogopen"),void 0!=this._width&&i(this.element).parent().width(this._width),void 0!=this._height&&i(this.element).parent().height(this._height),this.options.scope&&i(this.overlay).wrap('<div class="'+this.options.scope+'-scope"></div>'),this._position(),p},updateDelay:function(i){if(this.currentTimerId&&(window.clearTimeout(this.currentTimerId),this.currentTimerId=void 0),void 0!==i&&i>0){var t=this;this.currentTimerId=window.setTimeout(function(){t.open(),t.currentTimerId=void 0},i)}},destroy:function(){var o=(this.originalPosition,i("body"));this.originalPosition.parent=o,this.originalPosition.index=o.children().length,t.destroy.call(this)}})}(jQuery,jQuery.ui.dialog.prototype),$.ccfregistry.pluginReady("coreDialog");